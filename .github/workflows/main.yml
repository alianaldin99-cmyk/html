name: ii

on:
  workflow_dispatch:
    inputs:
      source_url:
        description: 'Source Stream Link (e.g., http://.../index.m3u8)'
        required: true
        type: string
      stream_key:
        description: 'Your OK.ru Stream Key (full key â€“ masked in logs)'
        required: true
        type: string

jobs:
  restream:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    steps:
      - name: Install FFmpeg
        run: sudo apt update && sudo apt install -y ffmpeg

      - name: Mask Stream Key (Extra Security)
        run: echo "::add-mask::${{ inputs.stream_key }}"

      - name: Start Restream to OK.ru
        run: |
          SOURCE="${{ inputs.source_url }}"
          TARGET="rtmp://ovsu.okcdn.ru/input/${{ inputs.stream_key }}"
          
          ffmpeg -re -i "$SOURCE" \
            -c copy \
            -f flv \
            "$TARGET" \
            -stats -loglevel warning
